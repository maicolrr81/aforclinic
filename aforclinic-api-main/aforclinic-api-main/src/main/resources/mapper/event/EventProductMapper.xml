<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xenialsoft.api.core.event.mapper.EventProductMapper">

    <resultMap id="product" type="EventProduct">
        <id     property="eventId"              column="event_id" />
        <id     property="productId"            column="product_id" />
        <result property="adjustedPrice"        column="adjusted_price" />
        <result property="discountedPrice"      column="discounted_price" />
        <result property="mainVisible"          column="is_main_visible" />
        <result property="displayOrder"          column="display_order" />
        <association property="product" javaType="Product">
            <id     property="id"           column="product_id" />
            <result property="name"         column="product_name" />
            <result property="description"  column="product_description" />
        </association>
    </resultMap>
    
    <select id="selectListById" resultMap="product">
        select a.event_id
             , a.product_id
             , b.name               as product_name
             , b.description        as product_description
             , a.adjusted_price
             , a.discounted_price
             , a.is_main_visible
             , a.display_order
          from event_products a
    inner join product b
            on a.product_id = b.id
         where a.event_id = #{id}
           and b.status = 'active'
      order by a.display_order, b.name
    </select>
    
    <select id="selectTotalCount">
        select count(*)
          from event_products a
         where a.event_id = #{id}
    </select>

    <insert id="insert">
        insert into event_products (
            event_id
            , product_id
            , adjusted_price
            , discounted_price
            , is_main_visible
            , display_order
        ) values (
            #{eventId}
            , #{productId}
            , #{adjustedPrice}
            , #{discountedPrice}
            , #{mainVisible}
            , #{displayOrder}
        )
    </insert>
    
    <delete id="delete">
        delete
          from event_products
         where event_id = #{eventId}
    </delete>

</mapper>